// ------------------------------
// 题干：9. “a+”、“r+”和“w+”哪种模式更适合修改文件已有内容？
// 知识要点：
//  1. 模式规则：
//     - r+：读写，文件必须存在，写操作可定位
//     - w+：读写，清空文件（若存在），写从开头
//     - a+：读写，写操作强制追加到末尾，读可定位
//  2. 定位函数：fseek可移动文件指针
// 总体逻辑：
//  1. 测试三种模式修改文件中间内容的能力
#include <stdio.h>

int main() {
    // ---- 准备测试文件：先写入"ABCDE" ----
    FILE *init = fopen("test_file.txt", "w");
    fprintf(init, "ABCDE");
    fclose(init);
    
    // ---- 测试r+模式：可定位修改中间内容 ----
    FILE *fp_r = fopen("test_file.txt", "r+");
    fseek(fp_r, 2, SEEK_SET); // 移动到第3个字符（索引2，字符'C'的位置）
    fputc('X', fp_r); // 修改为"AXCDE"
    fclose(fp_r);
    
    // ---- 测试a+模式：写操作强制追加到末尾 ----
    FILE *fp_a = fopen("test_file.txt", "a+");
    fseek(fp_a, 2, SEEK_SET); // 尝试定位到中间
    fputc('Y', fp_a); // 实际写入文件末尾，内容变为"AXCDEY"
    fclose(fp_a);
    
    // ---- 测试w+模式：会清空文件，不适合修改已有内容 ----
    FILE *fp_w = fopen("test_file.txt", "w+"); // 清空文件，重新写入
    fprintf(fp_w, "ABCDE"); 
    fseek(fp_w, 2, SEEK_SET);
    fputc('Z', fp_w); // 看似修改中间，实际是对新文件的修改（原内容已被清空）
    fclose(fp_w);
    
    printf("测试结论：\n");
    printf("- r+ 模式：可定位修改已有内容（文件必须存在）\n");
    printf("- a+ 模式：写操作强制追加到末尾，无法修改中间\n");
    printf("- w+ 模式：会清空文件，不适合修改已有内容\n");
    return 0;
}

// 测试验证方案：
//  1. 运行：编译后执行，查看test_file.txt的最终内容
//  2. 实际观察（结合代码逻辑）：
//     - r+ 模式修改后：内容为"AXCDE"（中间被修改）
//     - a+ 模式修改后：内容为"AXCDEY"（Y追加到末尾）
//     - w+ 模式：文件被清空后重新写入并修改，实际是"AZCDE"（但这是新文件的修改，非原有内容）
//  3. 结论：r+ 最适合修改已有内容
// 易错点提醒：
//  1. 混淆r+和w+：w+会清空文件，绝对不能用于修改已有内容
//  2. 以为a+的写操作可以定位，实际a+的写始终追加到末尾
// 拓展思考：
//  1. 若用a+模式，如何实现“修改中间内容”？（无法直接修改，需读取内容到内存修改后重新写入）
//  2. r+模式下，若文件不存在会怎样？（fopen返回NULL，打开失败）
// ------------------------------