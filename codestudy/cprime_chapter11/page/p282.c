// ------------------------------
// 知识要点总结：
//  1. gets() 函数：读取**一整行输入**（直到换行符），丢弃换行符，在末尾加 '\0' 形成字符串。  
//  2. puts() 函数：输出字符串，**自动在末尾加换行符**，常与 gets() 搭配。  
//  3. 数组分配：必须提前定义足够大的字符数组（如 STLEN 81，存 80 字符 + 1 个 '\0'），否则 gets() 会因输入过长导致 **缓冲区溢出**（覆盖其他内存，程序崩溃）。  
//  4. 安全风险：gets() 不检查输入长度，输入超过数组大小时，会破坏程序其他数据，甚至引发安全问题，因此**实际开发应避免使用**（C11 已废弃）。  
// 总体逻辑说明：  
//  1. 定义字符数组 `words`（长度 81），用于存储用户输入。  
//  2. 用 puts() 提示用户输入字符串。  
//  3. 用 gets() 读取整行输入（包括空格，直到用户按回车）。  
//  4. 用 printf 和 puts 分别输出输入的字符串（验证两者功能），最后输出 "Done."。  


#include <stdio.h>
#define STLEN 81  // 定义数组长度：80个字符 + 1个 '\0'（给结束符留空间）

int main(void) {
    char words[STLEN];  // 分配空间：能存 80 个字符 + 结束符 '\0'

    puts("Enter a string, please.");  // 提示用户输入（puts自动换行）
    gets(words);  // 危险！读取一整行输入，不检查长度，可能导致溢出

    printf("Your string twice:\n");
    printf("%s\n", words);  // printf输出字符串，需手动加\n换行
    puts(words);  // puts自动在末尾加换行，更方便
    puts("Done.");

    return 0;
}


// ------------------------------
// 测试验证建议方案：  
//  1. 正常输入测试：  
//     - 运行程序，输入短字符串（如 "Hello C!" ，长度 <80 ）。  
//     - 预期输出：  
//       Enter a string, please.  
//       Hello C!（用户输入）  
//       Your string twice:  
//       Hello C!  
//       Hello C!  
//       Done.  
//  2. 超长输入测试（演示风险）：  
//     - 修改代码中 `#define STLEN 5`（故意缩小数组，方便测试）。  
//     - 输入超长字符串（如 "I think I'll be just fine." ，长度 >5 ）。  
//     - 预期结果：程序可能崩溃（如终端提示 `Segmentation fault` ），或输出异常（因溢出破坏内存）。  
//  3. 编译器警告观察：  
//     - 用 gcc 编译：`gcc getsputs.c -o getsputs` ，会收到类似 `warning: the 'gets' function is dangerous...` 的提示，说明 gets() 已被标记为不安全。  

// ------------------------------
// 易错点提醒：  
//  1. 忘记分配数组空间：  
//     → 若写成 `char *words; gets(words);` ，`words` 是未初始化的指针，可能指向任意地址，导致程序崩溃（必须用数组或动态分配内存）。  
//  2. 输入超长字符串：  
//     → 即使数组长度设为 81，若用户输入 100 个字符，gets() 会继续写入数组外的内存，破坏程序其他数据（这就是“缓冲区溢出”漏洞的根源）。  
//  3. 混淆 puts 和 printf 的换行：  
//     → puts 自动换行，printf 用 `%s` 时需手动加 `\n` ，否则两次输出会连在一起（如 `printf("%s", words);` 会和下一行紧挨着）。  

// ------------------------------
// 拓展思考（更安全的替代方案）：  
//  1. 用 fgets() 替代 gets()：  
//     → 改写输入代码：  
//       fgets(words, STLEN, stdin);  // 限制最多读 STLEN-1 个字符，更安全  
//       // 注意：fgets 会保留输入的换行符，需手动去掉：  
//       words[strcspn(words, "\n")] = '\0';  // 把换行符换成 '\0'  
//  2. 动态分配内存：  
//     → 用 `char *words = malloc(STLEN);` 分配空间（需 `#include <stdlib.h>` ），使用后 `free(words);` 释放，灵活控制数组大小。  
//  3. 对比 scanf 和 gets：  
//     → scanf("%s", words) 只能读“一个单词”（遇到空格/换行停止），而 gets() 读“一整行”（包括空格），但安全性差。  