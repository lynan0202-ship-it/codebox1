
/*
代码名称：compare.c
知识要点总结：
1. 字符串比较：使用strcmp函数（来自<string.h>）比较内容，而非指针地址比较（避免用==比较字符串指针）。
2. 安全输入处理：自定义s_gets函数，基于fgets实现，处理换行符和输入缓冲区残留，防止缓冲区溢出。
3. 宏定义：用#define定义常量（SIZE和ANSWER），增强代码可维护性。
4. 循环逻辑：通过while循环持续验证输入，直到匹配预设答案。

代码总体逻辑：
1. 程序启动后，提示问题“Who is buried in Grant's tomb?”。
2. 调用s_gets读取用户输入到try数组。
3. 用strcmp比较try和ANSWER：若不相等（返回非0），则提示错误并重新读取输入；若相等，输出正确提示。
4. s_gets函数内部：
   - 先用fgets读取最多n-1个字符（留空字符位置）。
   - 检查读取成功后，遍历字符找换行符：若找到，替换为'\0'（结束字符串）；若没找到（输入超长），则循环读取多余字符直到换行，清理输入缓冲区。
*/

#include <stdio.h>
#include <string.h>  // 包含strcmp函数的原型，用于字符串内容比较

#define ANSWER "Grant"  // 定义预设的正确答案（字符串常量）
#define SIZE 40         // 定义输入缓冲区的大小，需保证足够存储输入内容

// 函数声明：自定义安全输入函数，处理换行符和输入溢出问题
char *s_gets(char *st, int n);

int main(void)
{
    char try[SIZE];  // 定义字符数组，存储用户输入的答案

    // 输出问题提示
    puts("Who is buried in Grant's tomb?");
    // 调用s_gets读取用户输入，存入try数组
    s_gets(try, SIZE);

    // 核心比较逻辑：strcmp返回0表示两个字符串内容相等
    // 【易错点】：不能用 try == ANSWER 比较！因为这是比较指针地址，而非字符串内容
    // ANSWER是字符串常量（存储在只读区），try是栈上的数组，两者地址必然不同
    while (strcmp(try, ANSWER) != 0)
    {
        // 输入不匹配时，提示错误并要求重新输入
        puts("No, that's wrong. Try again.");
        s_gets(try, SIZE);  // 重新读取输入
    }

    // 输入匹配时，输出正确提示
    puts("That's right!");
    return 0;
}

// 自定义安全输入函数：解决fgets的两个问题——换行符残留、输入超长导致的缓冲区残留
char *s_gets(char *st, int n)
{
    char *ret_val;  // 存储fgets的返回值，用于判断读取是否成功
    int i = 0;      // 用于遍历字符串的索引

    // 调用fgets读取输入：最多读n-1个字符（留1个位置给'\0'），从标准输入(stdin)读取
    ret_val = fgets(st, n, stdin);

    // 如果读取成功（ret_val不为NULL，即输入有效）
    if (ret_val)
    {
        // 遍历字符串，寻找换行符('\n')或字符串结束符('\0')
        while (st[i] != '\n' && st[i] != '\0')
        {
            i++;
        }

        // 如果找到换行符（说明输入未超过缓冲区大小）
        if (st[i] == '\n')
        {
            st[i] = '\0';  // 将换行符替换为字符串结束符，去掉换行
        }
        else  // 没找到换行符（说明输入超长，缓冲区还有残留字符）
        {
            // 循环读取多余字符，直到遇到换行符，清理输入缓冲区
            while (getchar() != '\n')
            {
                continue;  // 持续读取，直到清空缓冲区
            }
        }
    }

    // 返回fgets的返回值（调用者可通过该值判断读取是否成功，本例未处理失败场景）
    return ret_val;
}

/*
代码测试及验证建议方案：
1. 正常流程测试：输入“Grant”，检查是否输出“That's right!”。
2. 错误输入测试：输入“Lincoln”“Washington”等错误答案，检查是否循环提示错误，直到输入正确。
3. 超长输入测试：输入超过39个字符（如40个连续字母），检查s_gets是否处理：
   - 若输入长度≤39，换行符被替换为'\0'；
   - 若输入长度>39，多余字符被getchar清理，下次输入正常。
4. 大小写测试：输入“grant”（小写），观察结果（因strcmp区分大小写，会判定错误；可拓展练习：添加转大写功能后重新测试）。
5. 边界测试：输入空字符串（直接按回车），检查程序是否进入循环提示错误。

易错点强化提醒：
- 字符串比较必须用strcmp！用==比较的是指针地址，永远不相等（除非两个指针指向同一块内存）。
- s_gets的核心作用：修复fgets的“换行符残留”和“输入溢出”问题，让输入更安全。
- 若需支持大小写不敏感的比较，需额外编写代码（如将输入和答案都转成大写后再比较）。
*/