/* 
知识要点总结：
1. 空字符（'\0'）：整数类型，ASCII码为0，用于标识字符串结束，占1字节。
2. 空指针（NULL）：指针类型，代表无效内存地址，fgets返回NULL表示读取到文件末尾。
3. fgets函数用法：`fgets(缓冲区, 最大长度, 输入流)`，最多读取`最大长度-1`个字符，剩余位置存'\0'，可读取换行符。
4. 输入处理逻辑：清理换行符（替换为'\0'）或多余字符（通过getchar丢弃），避免输入残留影响后续操作。

代码总体逻辑：
- 提示用户输入字符串，输入空行（仅换行符）则退出。
- 循环使用fgets读取输入：
  - 若fgets返回NULL（文件结束）或首字符是'\n'（空行），结束循环。
  - 否则遍历字符串，找到换行符或空字符的位置：
    - 若为换行符，替换为'\0'（使字符串正确结束）。
    - 若为空字符（说明一行内容超过缓冲区大小），循环调用getchar丢弃剩余字符直到换行。
  - 输出处理后的字符串。
- 循环结束后输出"done"。
*/

#include <stdio.h>
#define STLEN 10  // 定义缓冲区大小，fgets会留1个位置存'\0'，所以实际最多存9个字符

int main(void)
{
    char words[STLEN];  // 用于存储输入的字符串
    int i;

    puts("Enter strings (empty line to quit):");  // 提示输入，空行退出
    // fgets返回NULL表示文件结束，words[0]=='\n'表示空行，满足任一条件则退出循环
    while (fgets(words, STLEN, stdin) != NULL && words[0] != '\n')
    {
        i = 0;
        // 遍历字符串，直到找到换行符（'\n'）或空字符（'\0'）
        // 换行符：正常输入的行结尾；空字符：输入内容超过STLEN-1个字符，fgets自动添加的结束符
        while (words[i] != '\n' && words[i] != '\0')
            i++;  // 移动到目标字符的位置
        
        if (words[i] == '\n')  // 如果找到换行符（说明一行内容未超过缓冲区）
            words[i] = '\0';  // 将换行符替换为'\0'，使字符串正确结束
        else  // 否则，说明输入内容超过STLEN-1个字符，剩余字符还在输入缓冲区
        {
            // 循环读取剩余字符，直到遇到换行符（丢弃多余字符，避免影响后续输入）
            while (getchar() != '\n')
                continue;  // 持续读取，直到换行符
        }

        puts(words);  // 输出处理好的字符串
    }

    puts("done");  // 循环结束，输出结束提示
    return 0;
}

/* 
代码测试及验证建议方案：
1. 短字符串测试：
   - 输入："This"（4个字符），按回车。预期输出："This"，换行符被替换为'\0'。
   - 检查：输出是否与输入一致，无多余字符。

2. 刚好填满缓冲区测试：
   - 输入："123456789\n"（9个字符+换行），fgets读9个字符+'\0'，剩余换行符被getchar清理。预期输出："123456789"。
   - 检查：输出长度是否为9，无换行残留。

3. 超长字符串测试：
   - 输入："program seems\n"（超过9个字符），fgets读前9个字符"program s"，剩余字符被getchar丢弃。预期输出："program s"。
   - 检查：输出是否为前9个字符，后续输入（如再输"test"）是否正常处理。

4. 空行测试：
   - 直接按回车（输入空行），预期退出循环，输出"done"。
   - 检查：是否立即退出，输出"done"。

5. 文件结束测试（终端按Ctrl+D）：
   - 触发文件结束，fgets返回NULL，循环结束，输出"done"。
   - 检查：是否正确处理文件结束场景。

6. 易错点验证：
   - 修改STLEN为5，测试"abcdef\n"（6个字符），预期输出"abcde"，剩余字符被清理。
   - 观察空字符（'\0'是字符串结束符，整数0）和空指针（NULL是指针，代表无效地址）的行为差异。
*/