
/*
 * 代码名称：整数转二进制字符串（移位运算实现）
 * 知识要点总结：
 *   1. 移位运算：通过右移（>>）操作逐位提取整数的二进制位。
 *   2. 位掩码：用八进制掩码 `01`（二进制 `00000001`）提取整数的最后一位。
 *   3. 字符转换：将提取的二进制位（0 或 1）转换为字符 '0' 或 '1'。
 *   4. 字符串格式化：通过 `show_bstr` 函数按“4位一组”打印二进制字符串，提升可读性。
 *   5. 类型位数计算：利用 `CHAR_BIT`（每个 `char` 的位数，通常为 8）和 `sizeof(int)` 计算 `int` 类型的总位数。
 * 总体逻辑说明：
 *   程序分为三个核心部分：
 *   1. `itobs` 函数：通过循环右移整数，结合掩码 `01` 逐位提取二进制位，并转换为字符存入数组。
 *   2. `show_bstr` 函数：遍历二进制字符串，每打印 4 个字符就输出一个空格，让结果更易读。
 *   3. `main` 函数：读取用户输入的整数，调用 `itobs` 转换为二进制字符串，再用 `show_bstr` 格式化输出，直到输入非数字时结束程序。
 */

#include <stdio.h>
#include <limits.h>  // 用于获取 CHAR_BIT（char 类型的位数，通常为 8）

// 声明将整数转为二进制字符串的函数
char *itobs(int n, char *ps);
// 声明按4位一组打印二进制字符串的函数
void show_bstr(const char *str);

int main(void)
{
    // 定义存储二进制字符串的数组，长度为 int 类型的位数 + 1（用于存储字符串结束符 '\0'）
    char bin_str[CHAR_BIT * sizeof(int) + 1];
    int number;

    puts("Enter integers and see them in binary.");
    puts("Non-numeric input terminates program.");

    // 循环读取整数，直到输入非数字（scanf 返回值不等于 1 时停止）
    while (scanf("%d", &number) == 1)
    {
        // 调用 itobs 函数将整数转换为二进制字符串，存入 bin_str
        itobs(number, bin_str);
        printf("%d is ", number);
        // 调用 show_bstr 函数按4位一组格式化输出二进制字符串
        show_bstr(bin_str);
        putchar('\n');
    }

    puts("Bye!");
    return 0;
}

/*
 * 函数：itobs
 * 功能：将整数 n 转换为二进制字符串，存储到字符数组 ps 中
 * 参数：
 *   - n：待转换的整数
 *   - ps：用于存储结果的字符数组（需提前分配足够空间）
 * 返回值：指向结果字符串的指针（即 ps）
 */
char *itobs(int n, char *ps)
{
    // 计算 int 类型的总位数：每个 char 的位数 * int 类型的字节数
    const static int size = CHAR_BIT * sizeof(int);
    int i;

    // 从最高位到最低位循环（共 size 次）
    for (i = size - 1; i >= 0; i--, n >>= 1)
    {
        // 用八进制掩码 01（二进制 00000001）提取 n 的最后一位
        // 结果为 0 或 1，加上 '0' 后转换为字符 '0' 或 '1'，存入数组对应位置
        ps[i] = (01 & n) + '0';
    }
    // 在数组末尾添加字符串结束符，标记字符串的结束
    ps[size] = '\0';
    return ps;
}

/*
 * 函数：show_bstr
 * 功能：按“4位一组”的格式打印二进制字符串，增强可读性
 * 参数：
 *   - str：要打印的二进制字符串
 */
void show_bstr(const char *str)
{
    int i = 0;
    // 遍历字符串，直到遇到字符串结束符 '\0'
    while (str[i])
    {
        putchar(str[i]);
        // 每打印4个字符，且后面还有字符时，输出一个空格
        if (++i % 4 == 0 && str[i])
            putchar(' ');
    }
}


/*
 * 代码测试及验证建议方案：
 * 1. 测试正整数：输入 `7`，预期输出二进制为 `0000 0000 0000 0000 0000 0000 0000 0111`。
 * 2. 测试较大正整数：输入 `2013`，预期输出二进制为 `0000 0000 0000 0000 0000 0111 1101 1101`。
 * 3. 测试负整数：输入 `-1`，预期输出二进制为 `1111 1111 1111 1111 1111 1111 1111 1111`（以补码形式展示）。
 * 4. 测试边界值：输入 `INT_MAX`（可直接使用 `<limits.h>` 中的宏，或输入 `2147483647`），观察最高位为 `0` 的二进制形式。
 * 5. 测试非数字输入：输入字母（如 `q`），验证程序是否输出 `Bye!` 并正常终止。
 * 6. 手动对比测试：手动计算小整数（如 `5`）的二进制（`0000 0000 0000 0000 0000 0000 0000 0101`），与程序输出对比是否一致。
 */