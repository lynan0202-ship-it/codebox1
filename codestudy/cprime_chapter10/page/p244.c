// ------------------------------
// 知识要点总结：
//  1. 数组大小的合法规则（C99 之前）：
//     - 必须用“整型常量表达式”（如 #define、sizeof、强制类型转换后的整数）
//     - 数组大小必须 >0，且是整数（不能用小数、负数、变量，除非是 C99 的 VLA）
//  2. 整型常量表达式示例：
//     - #define 定义的符号常量（SIZE）
//     - 整数字面量（144）
//     - sizeof 表达式（sizeof(int)）
//     - 常量运算（5*2+1、(int)2.5）
//  3. 非法数组大小示例：
//     - 负数（-4）、小数（2.5）、变量（n、m）（C99 之前不允许）
//  4. C99 变长数组（VLA）：允许用变量定义数组大小（但 C11 后变为可选特性）
// 
// 总体逻辑说明：
//  1. 先演示合法的数组声明（符合 C99 之前的规则）
//  2. 再故意写非法数组声明（注释掉，让编译器报错，帮助理解错误）
//  3. 最后演示 C99 的 VLA 特性（如果编译器支持）
//  4. 通过编译报错和运行结果，验证数组大小的规则
// ------------------------------

#include <stdio.h>
// 符号常量：合法的数组大小（C99 之前规则）
#define SIZE 4  

int main(void)
{
    // -------------------- 合法数组声明（C99 之前规则） --------------------
    // 1. 符号常量（推荐用法，方便修改）
    int arr1[SIZE];  

    // 2. 整数字面量（直接写整数）
    double lots[144];  

    // 3. sizeof 表达式（sizeof(int) 是整型常量）
    float arr3[sizeof(int) + 1];  

    // 4. 常量运算（5*2+1 是整型常量表达式）
    float arr4[5*2 + 1];  

    // 5. 强制类型转换（(int)2.5 转为整数 2，是常量）
    float arr5[(int)2.5];  


    // -------------------- 非法数组声明（初学者别学！） --------------------
    // 错误 1：数组大小为负数（必须 >0）
    // float arr6[-4];  

    // 错误 2：数组大小为小数（必须是整数）
    // float arr7[2.5];  

    // 错误 3：数组大小用变量（C99 之前不允许，除非是 VLA）
    // int n = 5;
    // float arr8[n];  


    // -------------------- C99 变长数组（VLA）演示（编译器支持时可用） --------------------
    // 如果编译器支持 C99/VLA，取消注释以下代码：
    // int m = 3;
    // // 用变量 m 定义数组大小（VLA 特性）
    // float arr9[m];  
    // printf("VLA 数组大小：%zu\n", sizeof(arr9)/sizeof(arr9[0]));  


    // 验证合法数组：给 arr1 赋值并输出
    for (int i = 0; i < SIZE; i++)
    {
        arr1[i] = i * 10;
        printf("arr1[%d] = %d\n", i, arr1[i]);
    }

    return 0;
}

// ------------------------------
// 测试及验证建议方案：
//  1. 合法代码测试：
//     a) 直接编译运行，确认程序能正常编译（无报错）
//     b) 观察输出，确认合法数组能正常赋值和访问
// 
//  2. 非法代码测试（理解错误类型）：
//     a) 取消注释“错误 1”（arr6[-4]），编译看报错：
//        - 提示“数组大小不能为负”或类似错误
//     b) 取消注释“错误 2”（arr7[2.5]），编译看报错：
//        - 提示“数组大小必须是整数”或类似错误
//     c) 取消注释“错误 3”（arr8[n]），编译看报错（C99 之前）：
//        - 提示“可变长度数组声明在此不允许”或类似错误
// 
//  3. VLA 特性测试（需要编译器支持）：
//     a) 确认编译器支持 C99/VLA（如 gcc 用 -std=c99 参数）
//     b) 取消注释 VLA 相关代码，编译运行：
//        - 输出 VLA 数组大小（m 的值，如 3）
//        - 观察是否能正常创建和使用 VLA
// 
//  4. 易错点提醒：
//     - 数组大小必须 >0：别写负数（-4）或 0，否则编译报错
//     - 区分“常量”和“变量”：#define 是常量，int n=5 是变量（C99 之前数组大小不能用变量）
//     - 小数和强制类型转换：(int)2.5 是合法常量，但直接写 2.5 是非法小数
// 
//  5. 拓展思考：
//     - 如果必须用变量定义数组大小，除了 VLA 还有其他方法吗？（提示：动态内存分配 malloc）
//     - 对比 VLA 和 malloc 动态数组的区别（作用域、内存分配位置等）
//     - 为什么 C 语言最初不允许用变量定义数组大小？（提示：和编译时确定内存布局有关）
// ------------------------------

// 编译运行说明（重要！）：
//  1. 测试非法代码时，每次只取消一个注释，否则报错信息会混乱
//  2. 测试 VLA 时，需添加编译参数（如 gcc -std=c99 code.c -o code）
//  3. 如果编译器不支持 VLA，VLA 代码会报错，属于正常现象（体现标准差异）